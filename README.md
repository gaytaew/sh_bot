# Shokz Bot - Telegram бот для выдачи аккаунтов

## Структура проекта

Проект разделен на модули для удобства поддержки и расширения:

```
.
├── main.py                 # Точка входа для запуска бота
├── config.py               # Конфигурация (токены, ключи)
├── models.py               # Модели данных (AccountData, AddressParts и т.д.)
├── constants.py            # Константы и словари синонимов
├── bot/                    # Модули Telegram бота
│   ├── keyboards.py        # Все клавиатуры бота
│   └── handlers/           # Обработчики команд и callback
│       ├── start.py        # Команда /start
│       ├── accounts.py     # Создание аккаунтов через категории
│       ├── ebay.py         # Обработка eBay скриншотов (OCR + GPT)
│       ├── status.py       # Обновление статуса аккаунтов
│       └── common.py       # Общие обработчики
├── services/               # Бизнес-логика (отделена от UI)
│   ├── google_sheets.py   # Работа с Google Sheets
│   ├── accounts.py         # Создание и управление аккаунтами
│   ├── receipts.py         # Генерация ссылок на квитанции
│   ├── address.py          # Искажение и парсинг адресов
│   └── ocr_gpt.py          # OCR и GPT обработка для eBay
├── receipts_config.py      # Конфигурация макетов квитанций
├── receipt_product_map.py  # Маппинг товаров на ID для Тильды
└── issues.py               # Шаблоны причин обращения
```

## Основные изменения

### Разделение ответственности

1. **Handlers** (`bot/handlers/`) - только обработка Telegram событий, не содержат бизнес-логику
2. **Services** (`services/`) - вся бизнес-логика изолирована от UI
3. **Models** (`models.py`) - типизированные структуры данных для передачи между слоями

### Различия между eBay и категориями

- **Категории**: адрес искажается перед записью в GS, для URL используются чистые компоненты
- **eBay**: адрес НЕ искажается, записывается как есть от GPT, парсится на компоненты для URL

Эти различия учтены в методах:
- `AccountService.create_account_from_category()` - искажает адрес
- `AccountService.create_account_from_ebay()` - не искажает адрес

## Установка и запуск

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Настройте `config.py` с вашими токенами и ключами

3. Запустите бота:
```bash
python main.py
```

## Преимущества новой структуры

1. **Модульность**: каждый модуль отвечает за свою область
2. **Гибкость**: легко добавлять новые магазины, категории, товары
3. **Тестируемость**: сервисы можно тестировать отдельно от Telegram
4. **Поддерживаемость**: изменения в одной функции не ломают другие

## Добавление нового функционала

### Добавить новый магазин для квитанций:
1. Добавьте конфигурацию в `receipts_config.py`
2. Обновите `ReceiptService.build_receipt_url()` при необходимости

### Добавить новую категорию получателей:
1. Добавьте лист в Google Sheets
2. Обновите `GoogleSheetsService.get_sheet_by_category()`
3. Добавьте кнопку в `category_keyboard()`

### Изменить логику искажения адресов:
1. Измените функции в `services/address.py`
2. Handlers не нужно трогать

